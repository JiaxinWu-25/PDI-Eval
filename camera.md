# 空间比例与透视一致性研究方法论：从相机模型到几何判别

为了深入研究**空间比例与透视一致性 (Scale & Perspective Consistency)**，本文档从基础物理模型出发，推导至严谨的数学矩阵，并最终落实为可量化的 AI 幻觉检测判别式。

## 目录

- [空间比例与透视一致性研究方法论：从相机模型到几何判别](#空间比例与透视一致性研究方法论从相机模型到几何判别)
  - [目录](#目录)
    - [1. 引言：透视一致性——AI 视频的“深水区”](#1-引言透视一致性ai-视频的深水区)
    - [2. 相机模型基础：投影的本质](#2-相机模型基础投影的本质)
    - [3. 相机内参 (Intrinsic)：定义的比例尺](#3-相机内参-intrinsic定义的比例尺)
      - [3.1 核心参数的作用](#31-核心参数的作用)
      - [3.2 在“一致性”中的重要性](#32-在一致性中的重要性)
    - [4. 相机外参 (Extrinsic)：空间定位与运动逻辑](#4-相机外参-extrinsic空间定位与运动逻辑)
      - [4.1 参数物理含义](#41-参数物理含义)
      - [4.2 外参的核心作用](#42-外参的核心作用)
      - [4.3 数学表征：外参矩阵的严谨形式](#43-数学表征外参矩阵的严谨形式)
    - [5. 空间几何要素：H, Z, X 的联动逻辑](#5-空间几何要素h-z-x-的联动逻辑)
      - [5.1 参数定义与物理意义](#51-参数定义与物理意义)
      - [5.2 静态投影方程：空间的瞬时映射](#52-静态投影方程空间的瞬时映射)
      - [5.3 深度耦合：H, Z, X 的自洽性约束](#53-深度耦合h-z-x-的自洽性约束)
      - [5.4 综合案例分析：动态演进的静态快照](#54-综合案例分析动态演进的静态快照)
    - [6. 空间一致性公式：从静态比例到动态变化](#6-空间一致性公式从静态比例到动态变化)
      - [6.1 动态变化率：缩放速度的平方反比定律](#61-动态变化率缩放速度的平方反比定律)
      - [6.2 严谨代数表达式：跨帧一致性判定](#62-严谨代数表达式跨帧一致性判定)
      - [6.3 二维像素坐标的全空间耦合约束](#63-二维像素坐标的全空间耦合约束)
        - [A. 纵横位移的深度抑制耦合 (Depth-Coupled Suppression)](#a-纵横位移的深度抑制耦合-depth-coupled-suppression)
        - [B. 消失点收敛约束 (Vanishing Point Consistency)](#b-消失点收敛约束-vanishing-point-consistency)
    - [7. 研究应用：利用“无参数判别式”检测 AI 幻觉](#7-研究应用利用无参数判别式检测-ai-幻觉)
      - [7.1 核心准则：H-X 齐次性约束 (H-X Homogeneity Rule)](#71-核心准则h-x-齐次性约束-h-x-homogeneity-rule)
      - [7.2 广义 H-VP 齐次性约束 (Generalized H-VP Homogeneity Constraint)](#72-广义-h-vp-齐次性约束-generalized-h-vp-homogeneity-constraint)
      - [7.3 AI 幻觉的三大典型诊断模型](#73-ai-幻觉的三大典型诊断模型)
        - [1. 尺度-轨迹脱节（Scale-Trajectory Decoupling）](#1-尺度-轨迹脱节scale-trajectory-decoupling)
        - [2. 动能-缩放失衡（Kinetic-Scale Imbalance）](#2-动能-缩放失衡kinetic-scale-imbalance)
        - [3. 隐含内参漂移（Implicit Intrinsic Drift）](#3-隐含内参漂移implicit-intrinsic-drift)
    - [8. 具体实现方法论：建立“透视一致性”专项评测基准 (Benchmark)](#8-具体实现方法论建立透视一致性专项评测基准-benchmark)
      - [8.1 评测工具链：三维几何感知层 (The Geometric Engine)](#81-评测工具链三维几何感知层-the-geometric-engine)
      - [8.2 审计工作流：三级几何校验 (The Audit Workflow)](#82-审计工作流三级几何校验-the-audit-workflow)
      - [8.3 专项压力测试：极端场景诊断 (Stress Testing)](#83-专项压力测试极端场景诊断-stress-testing)
      - [8.4 量化评分体系：PDI 指标 (The Report Card)](#84-量化评分体系pdi-指标-the-report-card)
        - [1. $\\epsilon\_{scale}$ —— 尺度一致性残差 (Scale Consistency Residual)](#1-epsilon_scale--尺度一致性残差-scale-consistency-residual)
        - [2. $\\epsilon\_{trajectory}$ —— 轨迹与透视残差 (Trajectory \& Perspective Residual)](#2-epsilon_trajectory--轨迹与透视残差-trajectory--perspective-residual)
        - [3. $\\sigma(H\_{3D})$ —— 3D 物理尺寸标准差 (3D Physical Size Stability)](#3-sigmah_3d--3d-物理尺寸标准差-3d-physical-size-stability)
        - [综合结论：PDI 指标的计算与价值](#综合结论pdi-指标的计算与价值)

---

### 1. 引言：透视一致性——AI 视频的“深水区”

在视觉生成的领域中，物体在向远处移动时，其体积缩放必须与其运动速度逻辑对齐。由于 AI 模型（如 Diffusion Models）缺乏显式的几何计算模块，常会出现“越跑越快”、“体积突变”或“滑步等物理幻觉。要攻克这一难题，必须回归计算机视觉的底层逻辑：**针孔相机模型**。

### 2. 相机模型基础：投影的本质

**针孔相机模型 (Pinhole Camera Model)** 是将三维世界（3D）的一点，通过一个“小孔”，投影到二维胶片（2D）上的数学变换。

*   **投影过程**：将 3D 世界的点转化为 2D 像素坐标。
*   **控制变量**：这一变换受**内参 (Intrinsic)** 和 **外参 (Extrinsic)** 两组参数约束。
*   **数学关联**：$P_{2d} = K \cdot [R | t] \cdot P_{3d}$。

---

### 3. 相机内参 (Intrinsic)：定义的比例尺

**内参决定了：光线进入镜头后，是如何在传感器上成像的。** 它只与相机自身的构造有关，不随相机位置变化。

$$K = \begin{bmatrix} f_x & s & c_x \\ 0 & f_y & c_y \\ 0 & 0 & 1 \end{bmatrix}$$

#### 3.1 核心参数的作用
*   **焦距 ($f_x, f_y$)**：决定了“放大倍率”。
    *   **透视影响**：焦距越短（广角镜），视野（FOV）越大，透视畸变越强烈（近大远小极夸张）；焦距越长（长焦镜），空间感会被“压缩”，近大远小差异变小。
*   **主点坐标 ($c_x, c_y$)**：图像传感器的中心点。光轴与图像平面的交点。
*   **畸变系数 (Distortion)**：如**桶形畸变**（中心凸起）或**枕形畸变**。

#### 3.2 在“一致性”中的重要性
*   **镜头呼吸感**：若内参（尤其是焦距 $f$）发生抖动，观众会感到画面在无规律缩放。
*   **特征失配**：AI 常犯的错误是背景符合 35mm 镜头，而运动物体却像用 85mm 镜头渲染的，导致物体与背景无法“粘合”。

---

### 4. 相机外参 (Extrinsic)：空间定位与运动逻辑

**外参决定了：相机在三维世界坐标系中的“位置”和“朝向”。** 它是建立“世界”与“相机”之间坐标联系的桥梁。

#### 4.1 参数物理含义
1.  **旋转矩阵 $R$**：描述世界坐标轴在相机坐标系中的方向。包含 3 个自由度（Pitch, Yaw, Roll）。若发生微小抖动，画面会像地震般晃动。
2.  **平移向量 $t$**：**非常重要！** $t$ 并不是相机在世界里的坐标，而是**世界原点在相机坐标系下的位置**。
    *   若已知相机的世界坐标 $C$，则 $t = -R \cdot C$。
    *   **视觉影响**：$t$ 的变化直接决定了**视差 (Parallax)**。

#### 4.2 外参的核心作用
*   **区分“相机动”还是“物体动”**：想象拍杂技表演，舞台中心是 (0,0,0)。外参记录了摄影师站在舞台的哪个坐标 ($t$) 及镜头仰俯角度 ($R$)。
    *   **AI 的通病**：分不清相机推进和物体走近。如果 AI 模拟相机推进却按“物体走近”生成，透视关系（背景伸缩率）就会对不上，产生“漂移”。
*   **产生视差 (Parallax)**：相机左移时，近处电线杆飞快倒退，远山几乎不动。如果没有外参逻辑，远近物体位移速度相同，视觉上会瞬间穿帮，显得像平面贴图。
*   **维持多视角一致性**：通过外参关联，保证从左侧和右侧拍摄的同一物体在 3D 空间上是同一个几何体。

#### 4.3 数学表征：外参矩阵的严谨形式

为了方便计算连续运动，通常使用 $4 \times 4$ 齐次变换矩阵：

$$T_{w2c} = \begin{bmatrix} R & t \\ 0 & 1 \end{bmatrix} = \begin{bmatrix} r_{11} & r_{12} & r_{13} & t_1 \\ r_{21} & r_{22} & r_{23} & t_2 \\ r_{31} & r_{32} & r_{33} & t_3 \\ 0 & 0 & 0 & 1 \end{bmatrix}$$

此外，在直接进行 3D 到 2D 的投影投影转换时，常简写为 $3 \times 4$ 的矩阵形式 $[R | t]$：

$$[R | t] = \begin{bmatrix} r_{11} & r_{12} & r_{13} & t_1 \\ r_{21} & r_{22} & r_{23} & t_2 \\ r_{31} & r_{32} & r_{33} & t_3 \end{bmatrix}$$

*   **平移与缩放的耦合**：物体在屏幕上的高度 $h$ 与其在相机坐标系下的距离 $Z_c$ 严格相关。
*   **计算逻辑**：$Z_c$ 由外参矩阵最后一行计算得出：$Z_c = r_{31}X_w + r_{32}Y_w + r_{33}Z_w + t_3$。外参矩阵就像是空间的“底账”，一旦账目不符，就是“幻觉重灾区”。

---

### 5. 空间几何要素：H, Z, X 的联动逻辑

在研究透视一致性时，**$H$（物理尺寸）**、**$Z$（深度）**、与 **$X$（水平偏移）** 构成了三维空间坐标系的核心。所有的“视觉幻觉”本质上都是这三者在投影到二维平面时失去了数学关联。我们基于**针孔相机模型**，将图像中心点（主点）设为原点 $(0,0)$，焦距设为 $f$。

#### 5.1 参数定义与物理意义

1.  **$H$ (Physical Size)**: 物体真实的物理高度（或宽度）。在运动过程中，它通常是一个**物理常量**。

2.  **$Z$ (Depth)**: 物体中心距离相机成像平面的垂直深度。它是控制缩放的**核心变量**。

3.  **$X$ (Horizontal Offset)**: 物体在三维空间中距离相机光轴的水平距离。它决定了物体的**横向站位**。

#### 5.2 静态投影方程：空间的瞬时映射

基于相似三角形原理，三维空间点到二维像素平面的映射遵循以下比例关系：

*   **高度投影（决定大小）**：像素高度 $h = f \cdot \frac{H}{Z}$

*   **水平投影（决定位置）**：像素坐标 $x = f \cdot \frac{X}{Z}$

#### 5.3 深度耦合：H, Z, X 的自洽性约束

这三个参数在单帧图像内必须满足严格的耦合关系。若违反，则产生单帧层面的“空间畸变”：

*   **Size-Depth 约束（近大远小）**：当 $H$ 固定时，$h \propto 1/Z$。

    *   **AI 幻觉：** 深度 $Z$ 增加（物体远去），但像素高度 $h$ 未按比例减小，导致物体呈现“巨人化”。

*   **Position-Depth 约束（消失点收敛）**：当 $X$ 固定时，$x \propto 1/Z$。

*   **逻辑：** 即使物体沿直线远去，$x$ 坐标也必须向图像中心收敛。

    *   **AI 幻觉：** “滑步/漂移”现象——物体缩小了，但水平位置未向中心靠拢，视觉上像是在地面横向滑动。

*   **几何恒等式（无参数约束）**：通过消去 $f$ 和 $Z$ 可得：$$\frac{h}{x} = \frac{H}{X}$$

    *   **核心准则：** 在物体不转弯（$H/X$ 比例恒定）时，其像素高度 $h$ 与离中心点的像素距离 $x$ 之比必须是**常数**。

#### 5.4 综合案例分析：动态演进的静态快照

假设 $H=1.8m$ 的人，站在水平偏移 $X=2m$ 处（设 $f=500$），从远方走近时的像素表现：

| 深度 $Z$ | 像素高度 $h$ | 像素坐标 $x$ | 比例 $h/x$ | 视觉逻辑 |
| :--- | :--- | :--- | :--- | :--- |
| 20m (远) | 45 px | 50 px | 0.9 | 画面中心的小点 |
| 10m (中) | 90 px | 100 px | 0.9 | 体积与偏离度同步翻倍 |
| 5m (近) | 180 px | 200 px | 0.9 | 视觉冲击力极强，迅速向边缘“飞出” |

---

### 6. 空间一致性公式：从静态比例到动态变化

如果说第 5 章定义了**状态（原函数）**，那么本章则通过**导数（变化率）**揭示视频中运动逻辑的本质。

#### 6.1 动态变化率：缩放速度的平方反比定律

为了理解物体移动时像素变化的“节奏感”，我们对 $h$ 关于 $Z$ 求导：

$$\frac{dh}{dZ} = -f \cdot H \cdot Z^{-2} = -\frac{f \cdot H}{Z^2}$$

这推导出了**像素缩放变化量 $\Delta h$** 的近似公式：

$$\Delta h \approx \left| \frac{f \cdot H}{Z^2} \right| \cdot \Delta Z$$

*   **物理内涵**：缩放速度与深度的**平方**成反比。

*   **视觉特征**：物体离相机越近，同样的位移 $\Delta Z$ 引起的体积跳变越剧烈；离得越远，体积变化越平缓。

#### 6.2 严谨代数表达式：跨帧一致性判定

在 AI 视频的长跨度位移中，必须使用精确形式：

$$\Delta h = h_2 - h_1 = \frac{f \cdot H}{Z_2} - \frac{f \cdot H}{Z_1} = - \frac{f \cdot H \cdot \Delta Z}{Z_1 \cdot Z_2}$$

*   **幻觉解析 A：速度感失真（“加速喷射”）**

    若 AI 模型仅习得线性缩放（分母为 $Z$ 而非 $Z^2$），物体在远处的缩小速度会远超物理理论，产生物体正在“超速逃逸”的视觉错觉。

*   **幻觉解析 B：体积突变（“近距离闪烁”）**

    在近距离（$Z$ 极小）时，$1/(Z_1 Z_2)$ 趋于无穷大。AI 对此区间的极高敏感度缺乏处理能力，常导致近处物体在每一帧发生不可控的形变或体积爆炸。


核心区别对照表如下：

| 维度 | $h \propto 1/Z$ (静态比例) | $\Delta h \propto \frac{\Delta Z}{Z_1 Z_2}$ (动态变化量) |
| :--- | :--- | :--- |
| **定义** | **状态方程 (State)** | **演化方程 (Evolution)** |
| **回答的问题** | “此时此刻，物体应该有多大？” | “从 A 到 B，物体缩小了多少？” |
| **数学性质** | 反比例函数（一次幂） | 增量函数（分母为二次幂级别） |
| **应用场景** | 抽查**单帧**的几何合理性 | 审计**连续帧**之间的运动逻辑 |
| **检测的幻觉** | **比例失调**（例如：远处的“巨人”） | **节奏不对**（例如：越跑越快、体积突变） |

---

#### 6.3 二维像素坐标的全空间耦合约束

透视一致性不仅是大小的变化，更是坐标系的全局对齐。对于点 $P(X, Y, Z)$，其像素位移（以 $x$ 为例）受三轴联动约束：

$$\Delta x = f_x \left( \frac{X + \Delta X}{Z + \Delta Z} - \frac{X}{Z} \right) = f_x \frac{Z \cdot \Delta X - X \cdot \Delta Z}{Z(Z + \Delta Z)}$$

该严谨公式揭示了 AI 视频在复杂运动下的两个崩塌点：

##### A. 纵横位移的深度抑制耦合 (Depth-Coupled Suppression)

*   **原理**：公式分母包含 $Z(Z+\Delta Z)$，意味着远处的物体（$Z$ 很大）其像素位移 $\Delta x$ 必须受到极大的压制。

*   **AI 幻觉**：远处的物体表现出与近处类似的移动像素量，产生“背景漂移”或“物体瞬移”感。

##### B. 消失点收敛约束 (Vanishing Point Consistency)

*   **原理**：若物体沿直线远去（$X/Z$ 比例恒定），其运动轨迹在像素平面上必须严格收敛于消失点。

*   **AI 幻觉**：物体在缩小的过程中，像素坐标 $x$ 的偏移率与高度 $h$ 的缩放率脱节（即违背了 $\frac{\Delta h}{h} = \frac{\Delta x}{x}$），导致物体看起来像是在“一边变小，一边在地平面上横向打滑”。

---


### 7. 研究应用：利用“无参数判别式”检测 AI 幻觉

在实际研究中，我们无需获知相机的精确内参 $f$ 或物体的真实尺寸 $H$，即可通过图像空间的像素特征构建“几何紧箍咒”。

#### 7.1 核心准则：H-X 齐次性约束 (H-X Homogeneity Rule)

**适用条件**：物体沿直线做纵向运动（即三维空间中 $\Delta X = 0$）。
**判定公式**：物体的**高度缩放比**必须严格等于其**中心点偏移比**。

$$\frac{h_1}{h_2} = \frac{x_1 - c_x}{x_2 - c_x} = \frac{Z_2}{Z_1}$$

*   $c_x$：图像主点（通常为画面水平中心）。
*   **一致性残差 ($\epsilon$)**：定义 $\epsilon = \left| \frac{h_1}{h_2} - \frac{x_1 - c_x}{x_2 - c_x} \right|$。若 $\epsilon > \tau$（阈值），则判定该视频序列存在几何幻觉。

---

#### 7.2 广义 H-VP 齐次性约束 (Generalized H-VP Homogeneity Constraint)

7.1 节的 H-X 约束有一个隐含前提：物体沿光轴方向做**纯纵向运动**（$\Delta X = 0$），此时消失点恰好位于图像主点 $(c_x, c_y)$。而真实场景中，物体往往沿任意方向斜向运动（例如沿公路斜走、朝画面左下角的地平线远去），对应的消失点 $VP$ 可能位于画面任意位置。广义 H-VP 约束将 H-X 规则推广到**任意运动方向**。

##### 推导过程

设物体在 3D 空间中沿固定方向 $\mathbf{d} = (D_X, D_Y, D_Z)$（$D_Z > 0$）运动，第 $t$ 帧的 3D 位置参数化为：

$$(X_t,\; Y_t,\; Z_t) = (X_0 + s_t D_X,\; Y_0 + s_t D_Y,\; Z_0 + s_t D_Z)$$

**第一步：定位消失点。** 当 $s_t \to \infty$ 时，投影点趋近于消失点：

$$VP = \left(f \cdot \frac{D_X}{D_Z} + c_x,\; f \cdot \frac{D_Y}{D_Z} + c_y\right)$$

**第二步：计算投影点到消失点的距离。** 以 $x$ 方向为例，第 $t$ 帧投影坐标：

$$x_t = f \cdot \frac{X_0 + s_t D_X}{Z_t} + c_x$$

与消失点的偏差：

$$x_t - VP_x = f \cdot \frac{X_0 + s_t D_X}{Z_t} - f \cdot \frac{D_X}{D_Z} = \frac{f}{Z_t} \cdot \frac{X_0 D_Z - Z_0 D_X}{D_Z}$$

分子 $X_0 D_Z - Z_0 D_X$ 是与时间无关的常数 $C$，故：

$$x_t - VP_x = \frac{f \cdot C_x}{Z_t}$$

$y$ 方向同理。于是**点到消失点的欧氏距离**为：

$$\text{Dist}(\mathbf{p}_t, VP) = \sqrt{(x_t - VP_x)^2 + (y_t - VP_y)^2} = \frac{f \cdot C}{Z_t}$$

其中 $C = \frac{\sqrt{(X_0 D_Z - Z_0 D_X)^2 + (Y_0 D_Z - Z_0 D_Y)^2}}{D_Z}$ 为常数。

**第三步：联立高度方程。** 由投影公式 $h_t = fH / Z_t$，可知 $h_t$ 与 $\text{Dist}(\mathbf{p}_t, VP)$ 均正比于 $1/Z_t$，消去公共因子得：

$$\boxed{\dfrac{h_1}{h_t} = \dfrac{Z_t}{Z_1} = \dfrac{\text{Dist}(\mathbf{p}_1,\; VP)}{\text{Dist}(\mathbf{p}_t,\; VP)}}$$

这就是**广义 H-VP 齐次性约束**的完整形式：**像素高度之比等于该时刻质心到消失点的距离之比**，且两者均严格等于深度之比。

##### 与 H-X 约束的关系

当运动为纯纵向（$D_X = D_Y = 0$）时，$VP = (c_x, c_y)$，距离公式退化为：

$$\text{Dist}(\mathbf{p}_t, VP) = \sqrt{(x_t - c_x)^2 + (y_t - c_y)^2}$$

若物体保持在光轴正前方（$X_t \approx X_0$），则 $y_t - c_y$ 远小于 $x_t - c_x$，进一步退化为 7.1 节的一维 H-X 约束 $h_1/h_t = (x_1 - c_x)/(x_t - c_x)$。因此 **H-X 约束是广义 H-VP 约束在消失点位于主点时的特殊情形**。

##### 工程意义

在 PDI 的 $\epsilon_{trajectory}$ 计算中，VP 由**双路消失点融合算法**（前景轨迹方向线 + 背景 LSD 线段 RANSAC）估算，而非固定为画面中心。这使轨迹审计能覆盖一切具有透视收敛性的运动方向：

| 运动类型 | 适用约束 | VP 位置 |
| :--- | :--- | :--- |
| 沿光轴正向走近/远去 | H-X（7.1 节） | 画面主点 $(c_x, c_y)$ |
| 斜向走向地平线（如公路） | 广义 H-VP（本节） | 画面内任意点 |
| 横向平移（$D_Z \approx 0$） | 不适用（VP 在无穷远） | 画面边缘以外 |

**一致性残差**定义为：

$$\epsilon_{trajectory}(t) = \left| \frac{h_1}{h_t} - \frac{\text{Dist}(\mathbf{p}_1, VP)}{\text{Dist}(\mathbf{p}_t, VP)} \right|$$

$\text{RMSE}(\epsilon_{trajectory})$ 越大，说明物体的缩放节奏与其向消失点收敛的速度越不同步，即存在"滑步"或"地平面漂移"幻觉。

---

#### 7.3 AI 幻觉的三大典型诊断模型

基于上述公式，我们可以将复杂的视觉错误归纳为三种可量化的诊断模型：

##### 1. 尺度-轨迹脱节（Scale-Trajectory Decoupling）
*   **现象**：物体在变小（$h_1/h_2 > 1$），但它在地面上向中心收敛的速度极慢（$\frac{x_1 - c_x}{x_2 - c_x} \approx 1$）。
*   **诊断**：$\epsilon \gg 0$。这表明模型模拟了“远去”的比例，但丢失了“消失点收敛”的位移逻辑。
*   **视觉后果**：**“滑步”或“地平面漂移”**。物体看起来像是在冰面上向侧后方滑动。

##### 2. 动能-缩放失衡（Kinetic-Scale Imbalance）
*   **现象**：物体动作频率很高（如快速奔跑），但 $h$ 的变化率远低于理论上的 $1/Z^2$ 衰减。
*   **诊断**：检测跨帧位移 $\Delta Z$ 与 $\Delta h$ 的相关性。若 $\Delta h \cdot Z_1 Z_2 / (fH)$ 偏离常数，则动力学失效。
*   **视觉后果**：**“太空步”或“越跑越快”**。物体的视觉位移与其体积变化率不匹配，产生运动速度的非线性幻觉。

##### 3. 隐含内参漂移（Implicit Intrinsic Drift）
*   **现象**：物体在画面不同位置时，其 $h/x$ 的比例发生跳变。
*   **诊断**：在一段连续视频中，计算不同时刻的“隐含焦距推值” $f^* = \frac{h \cdot Z}{H}$。若 $f^*$ 剧烈波动，说明模型在同一段视频里混淆了广角与长焦逻辑。
*   **视觉后果**：**“镜头呼吸感”或“空间扭曲”**。背景看起来稳定，但移动物体周边的空间表现出不自然的推拉感（Vertigo Effect）。



---

### 8. 具体实现方法论：建立“透视一致性”专项评测基准 (Benchmark)

为了攻克 AI 视频生成的“物理幻觉”，研究的重心应从定性观察转向定量审计。本研究提议构建一套基于“**几何还原-物理校验**”的评测框架，利用先进的视觉 SLAM 技术对 AI 视频的底层逻辑进行“数学审判”。

#### 8.1 评测工具链：三维几何感知层 (The Geometric Engine)
量化一致性的前提是将 2D 像素升维。推荐构建以下协同工具栈：

*   **核心几何引擎：Mega-SaM (3D SLAM/SfM)**
    *   **职能**：作为核心感知层。它不仅实现精准的对象分割，更通过深度学习驱动的 SLAM 技术，从单目视频中**直接恢复相机内参、外参轨迹 ($R, t$) 以及物体的稠密深度图 ($Z$)**。它是解耦“相机运动”与“物体运动”的关键。
*   **长程细化追踪：Co-Tracker / TAPIR**
    *   **职能**：作为精细化补充。提供亚像素级的长程点轨迹，用于辅助校验 Mega-SaM 在剧烈运动或遮挡瞬间的轨迹平滑度。
*   **多源 3D 校验：Dust3R / Mast3R**
    *   **职能**：作为独立第三方校验。无需相机校准，直接通过点图映射（Pointmap）恢复场景 3D 结构，用于与 Mega-SaM 的重建结果进行交叉验证，确保获取的深度 $Z$ 的可靠性。

#### 8.2 审计工作流：四维几何校验 (The Audit Workflow)
基于感知层还原的物理量（$h, x, Z, R, t$），通过四个维度进行系统审计（分别对应 PDI v2.0 的四项分量）：

1.  **尺度-深度自洽性校验 (h·Z Test - 尺度审计)** ← $\epsilon_{scale}$
    *   **逻辑**：根据 $h = fH/Z$，提取 Mega-SaM 输出的深度序列，验证残差 $\epsilon_{scale} = |h_1/h_2 - Z_2/Z_1|$。
    *   **目标**：量化检测物体在移动过程中是否发生了由于模型缺乏物理常数记忆而导致的"体积突变"。
2.  **运动学-消失点校验 (Vanishing Point Test - 轨迹审计)** ← $\epsilon_{trajectory}$
    *   **逻辑**：使用前景专属消失点 $VP_{fg}$（内源运动学解耦），校验物体缩放率是否与质心到 $VP_{fg}$ 的距离收敛率同步（广义 H-VP 约束，见 7.2 节）。若前景轨迹不足导致 $VP_{fg}$ 退化为主点，自动 fallback 至 $VP_{bg}$。
    *   **目标**：审计“物体相对于自己轨迹终点的运动学是否自洽”，识别纯簹的动力学失调（“滑步”、“越跑越快”）而不混入前背景空间错位的干扰。
3.  **体积/刚性稳定性校验 (Volume-Rigidity Stability - 稳定性审计)** ← $\sigma(R_{rigidity})$
    *   **逻辑**：优先使用 Mega-SAM pointmaps 在 3D 点云中测量物体逐帧 Y 轴高度范围，计算变异系数；若 pointmaps 无效则 fallback 至 Co-Tracker 点对距离比值协同度（std/mean）。
    *   **目标**：审计物体在运动过程中自身体积/形状是否保持稳定，同时兼顾真实 3D 高度稳定性与 2D 刚性稳定性两个层面。
4.  **视角耦合一致性校验 (VP Coupling Test - 全局审计)** ← $\epsilon_{vp}$
    *   **逻辑**：分别计算前景消失点 $VP_{fg}$（前景轨迹运动方向线求交）与背景消失点 $VP_{bg}$（LSD 场景几何线 RANSAC 求交），计算归一化偏移量 $\epsilon_{vp} = \|VP_{fg} - VP_{bg}\| / \text{diag}(\text{image})$。
    *   **目标**：检测前景物体与背景场景是否共享同一透视消失点，识别 AI 模型对前景与背景"独立建模"导致的空间解耦幻觉。若背景斜线段不足则自动置 0 跳过。

#### 8.3 专项压力测试：极端场景诊断 (Stress Testing)
设计三类探测 AI 模型几何逻辑临界点的极端场景：
*   **Dolly Zoom（希区柯克变焦）**：测试模型能否在相机位移（外参变）与镜头变焦（内参变）同时发生时，保持目标尺度与背景透视的逻辑对齐。
*   **遮挡恢复一致性 (Occlusion Recovery)**：利用 SLAM 恢复的轨迹，预测物体被遮挡期间的 $Z$ 轴变化，校验物体重现时的瞬时比例是否符合预测值。
*   **零距离交互 (Near-field Interaction)**：当物体极度贴近相机（$Z \to 0$）时，校验像素缩放率是否遵循 $1/Z^2$ 的爆发式增长及其几何形态的稳定性。

#### 8.4 量化评分体系：PDI v2.0 指标 (The Report Card)

最终，通过自动化脚本汇总各项校验的残差，建立 **PDI (Perspective Distortion Index，透视畸变指数)**。PDI v2.0 在原有三项几何审计的基础上，新增第四项**视角耦合一致性**审计，形成四维评估体系。

$$PDI = w_1 \cdot \text{RMSE}(\epsilon_{scale}) + w_2 \cdot \text{RMSE}(\epsilon_{trajectory}) + w_3 \cdot \sigma(R_{rigidity}) + w_4 \cdot \epsilon_{vp}$$

> 默认权重：$w_1 = 0.3,\ w_2 = 0.2,\ w_3 = 0.2,\ w_4 = 0.3$（traj 与 vp 权重对调：解耦后 vp 承担更多空间一致性诊断职责）

以下是公式中四个变量的详细拆解：

##### 1. $\epsilon_{scale}$ —— 尺度一致性残差 (Scale Consistency Residual)

*   **数学来源**：基于静态投影公式 $h = \frac{fH}{Z}$ 及其动态变形 $\frac{h_1}{h_2} = \frac{Z_2}{Z_1}$。
*   **具体含义**：它衡量的是**"像素高度的变化"与"深度的变化"是否匹配**。
    *   通过 **Mega-SaM** 提取深度 $Z$，利用像素点提取高度 $h$。
    *   如果深度增加了一倍（$Z$ 变大），但像素高度（$h$）只缩小了 20%，那么生成的预测高度与实际像素高度之间就会产生巨大的**残差 $\epsilon_{scale}$**。
*   **捕捉幻觉**：**"体积突变"**、**"近大远小比例失调"**。
*   **评价逻辑**：RMSE 越小，说明物体缩放越符合物理规律。

##### 2. $\epsilon_{trajectory}$ —— 轨迹与透视残差 (Trajectory & Perspective Residual)

*   **数学来源**：广义 H-VP 齐次性约束：$\frac{h_1}{h_t} = \frac{\text{Dist}(p_1, VP)}{\text{Dist}(p_t, VP)}$（完整推导见 7.2 节），其中 VP 由双路融合算法估算（审计流程见 8.2 节）。
*   **具体含义**：它衡量的是**"物体变小的速度"与"物体向消失点收敛的速度"是否同步**。
    *   如果一个物体在快速缩小，但其轨迹质心并未按比例靠近消失点，$\epsilon_{trajectory}$ 就会激增。
*   **捕捉幻觉**：**"滑步（Skating）"**、**"地平面漂移"**、**"越跑越快（动能不匹配）"**。
*   **评价逻辑**：审计运动轨迹是否指向正确的消失点。

##### 3. $\sigma(R_{rigidity})$ —— 体积/刚性稳定性 (Volume-Rigidity Stability)

*   **双策略实现**（优先级由高到低）：
    *   **策略 1（3D 高度法，优先）**：若 Mega-SAM 输出的 pointmaps 有效（非全零），在重建的世界坐标系点云中，逐帧提取前景 mask 内 Y 轴范围（$H_{3D}(t) = P_{95}(y) - P_5(y)$），计算跨帧变异系数 $\sigma(H_{3D}) / \mu(H_{3D})$。这是真实的**三维物理高度稳定性**审计。
    *   **策略 2（2D 刚性法，fallback）**：若 pointmaps 退化为全零，改用 Co-Tracker 点对距离比值协同度：
        $$R_{rigidity}(t) = \frac{\text{std}(d_{ij}(t) / d_{ij}(0))}{\text{mean}(d_{ij}(t) / d_{ij}(0))}$$
*   **具体含义**：无论哪种策略，均在衡量**物体在移动过程中，自身体积/形状是否保持稳定**。策略 1 直接在 3D 空间验证，策略 2 在 2D 轨迹空间验证刚性。
*   **捕捉幻觉**：**"体积呼吸感（Volume Breathing）"**、**"果冻化变形"**、**"3D 尺寸突变"**。
*   **评价逻辑**：两种策略的输出均为变异系数，数值越小说明物体越稳定。策略 1 精度更高但依赖 Mega-SAM 有效输出；策略 2 不依赖深度模型，鲁棒性更强。

##### 4. $\epsilon_{vp}$ —— 视角耦合一致性残差 (Perspective Coupling Consistency)

*   **数学来源**：双路消失点估算的偏移量，归一化到图像对角线：
    $$\epsilon_{vp} = \frac{\| VP_{fg} - VP_{bg} \|}{\text{diag}(\text{image})}$$
    其中 $VP_{fg}$ 由**前景轨迹**的运动方向线求交得到（"演员视角"），$VP_{bg}$ 由**背景轨迹 + LSD 场景几何线**融合 RANSAC 求交得到（"舞台视角"）。
*   **具体含义**：在真实世界中，物体的缩放中心（$VP_{fg}$）与场景的透视收敛点（$VP_{bg}$）**必须是同一个点**。AI 生成视频往往对物体与背景独立建模，导致两者"透视解耦"。
*   **捕捉幻觉**：**"贴图感"**、**"前景与背景不在同一欧氏空间"**、**"Dashcam 场景卡车与公路 VP 割裂"**。
*   **评价逻辑**：$\epsilon_{vp} \approx 0$ 为真实视频的几何恒等式；数值越大，说明 AI 模型的空间全局耦合越弱。
*   **鲁棒性保护**：若背景可检测斜线段少于阈值（如纯白背景），则 $\epsilon_{vp}$ 自动置 0，不参与本次评分。

##### 综合结论：PDI v2.0 指标的计算与价值

$$PDI = \underbrace{w_1 \cdot \text{RMSE}(\epsilon_{scale})}_{\text{缩放节奏对不对？}} + \underbrace{w_2 \cdot \text{RMSE}(\epsilon_{trajectory})}_{\text{路径指向对不对？}} + \underbrace{w_3 \cdot \sigma(R_{rigidity})}_{\text{物体稳不稳？}} + \underbrace{w_4 \cdot \epsilon_{vp}}_{\text{物体与场景同一空间吗？}}$$

*   **$w_1, w_2, w_3, w_4$**：权重系数，在 `configs/default.yaml` 中配置，默认 0.3 / 0.2 / 0.2 / 0.3，总和为 1.0。解耦后 $\epsilon_{vp}$ 权重提升至 0.3（承担空间耦合诊断主力），$\epsilon_{trajectory}$ 降至 0.2（专注纯运动学内源一致性）。
*   **RMSE**：放大"突发性"跳变（如体积炸裂）；$\epsilon_{vp}$ 本身已是全局标量，直接加权。

**总结**：
如果一个 AI 模型生成的视频 PDI 很低，意味着：当物体走远时，其缩小的节奏是对的（$\epsilon_{scale}$），走向消失点的路径也是对的（$\epsilon_{trajectory}$），物体自身在 3D 空间里是刚性的没有忽胖忽瘦（$\sigma(R_{rigidity})$），且物体与背景共用同一个透视消失点没有"贴图割裂感"（$\epsilon_{vp}$）。这就是衡量"完美空间一致性"的终极量化指标。

---

#### 8.5 测试prompt推荐
为了让 **PDI-Eval** 的审计效果最明显，最理想的测试示例应该包含**“深度方向的大跨度位移”**。

在物理世界中，物体沿 Z 轴（纵深方向）移动时，其像素高度 $h$ 与物理深度 $Z$ 的乘积应保持恒定。目前的视频生成模型（如 Sora, Kling, Luma）在处理这种**长距离纵深透视**时最容易出现“物理幻觉”。

以下是为您推荐的三类测试示例及其对应的生成 Prompt：

### 1. 消失点收敛测试 (最推荐：用于审计轨迹一致性)
**场景描述**：一个物体沿着一条笔直的公路或长廊，从极远方走向近处，或者从近处走向地平线。
**预期效果**：AI 往往能生成漂亮的背景，但物体的“缩放节奏”与背景的“透视收敛”往往不匹配。PDI 会检测到物体的运动轨迹并未真正指向画面的消失点（Vanishing Point）。

*   **Prompt (Kling/Luma/Sora)**:
    > "A high-quality cinematic shot of a man in a red jacket walking away from the camera down the exact center of a long, straight desert highway that stretches to the horizon. Deep perspective, clear vanishing point, the man becomes smaller and smaller as he reaches the distance. 4k, realistic lighting."

### 2. “体积呼吸感”测试 (用于审计尺度与体积稳定性)
**场景描述**：一个体型较大的动物（如金毛犬或大象）直接冲向镜头。
**预期效果**：当物体从远及近快速靠近时，AI 经常会出现“体积膨胀”或“软体化”现象（看起来物体变大了，但比例失调）。PDI 的 `Volume Audit` 能敏锐捕捉到 3D 高度在移动过程中的非物理波动。

*   **Prompt (Kling/Luma/Sora)**:
    > "A large golden retriever running excitedly directly towards a fixed camera in a wide green meadow. The camera is positioned at the dog's eye level. The dog starts from 20 meters away and ends up very close, filling the entire frame. 4k, realistic physics, consistent body shape."

### 3. “背景滑步”测试 (用于审计相机位姿一致性)
**场景描述**：侧向滑动的横移镜头（Dolly Shot），物体在前景移动，背景在后方平移。
**预期效果**：AI 模型经常处理不好前景物体与地面的摩擦力关系，产生“滑步（Skating）”感。PDI 会发现物体的 2D 位移与 3D 深度还原出的相机轨迹存在几何冲突。

*   **Prompt (Kling/Luma/Sora)**:
    > "A side-view tracking shot of a silver futuristic sports car driving at a constant speed along a wet city street at night. Neon signs reflect on the ground. The camera moves parallel to the car. High frame rate, consistent ground contact, 4k."

---

### 给您的测试建议 (Step-by-Step)：

1.  **对比实验**：建议先找一段**真实拍摄**的类似视频（比如您自己拿着手机在走廊拍一段人走远的视频）作为 **A级基准** 跑一遍，观察 PDI 分数（通常会在 0.05 以下）。
2.  **点位选择**：在 `main.py` 或 `app.py` 中，点击物体的**底部中心（如足部）**，这有助于 `Co-Tracker` 提取到最能反映地平面透视关系的轨迹。
3.  **观察指标**：
    *   如果 `Scale Component` 高：说明物体变大变小的速度不对（透视畸变）。
    *   如果 `Traj Component` 高：说明物体看起来在地面上“漂浮”或“滑行”（滑步感）。
    *   如果 `Volume Component` 高：说明物体在走动时，身体比例在不停地闪烁或变形（体积呼吸）。

**您可以先从 Prompt 1（长路漫步）开始，这是目前 PDI-Eval 杀伤力最大的测试场景！**


### 二、 Mega-SAM 的“黄金适用场景”是什么？

Mega-SAM 的名字里有一个关键词叫 **"Casual" (随意的)**。它的设计初衷并不是为了审计像你这种“远景、高速、固定视角”的工业场景，而是为了**“手持近景动态场景”**。

#### ✅ 它最擅长的场景（能跑出完美 3D 的情况）：
1.  **手持拍摄（Handheld）**：拍摄者拿着相机走动，有明显的左右晃动和位移。这种晃动为 SfM 提供了必要的**“视差燃料”**。
2.  **环绕拍摄（Orbital）**：相机绕着一个物体（如人或雕塑）转。
3.  **多层遮挡（Complex Occlusion）**：前景有电线杆，中景有人，背景有楼房。不同层级的位移差能让算法迅速看清空间。
4.  **短距离、中低速**：物体离相机在 2 米到 10 米之间，且有侧向运动。

#### ❌ 它的“重灾区”（也就是你现在的场景）：
1.  **纯纵向运动（Pure Axial Motion）**：物体正对着镜头走。
2.  **固定机位（Fixed Camera）**：相机在三脚架上，或者位移极小。
3.  **大纵深、远景（Deep Scenes）**：铁轨一直延伸到 50 米外。单目模型对远处 1 米的误差和近处 1 厘米的误差在像素上是一样的，导致精度急剧下降。

在 **PDI-Eval** 的实验部分（Experiment Section），你的目标是证明这个框架不仅能**量化**视觉违和感，还能**区分**不同生成模型的物理模拟水平。

为了让论文更具说服力，实验设计应遵循“**从真值校验到模型打分，再到幻觉定性**”的逻辑。以下是详细的实验设计建议：

---

### 一、 实验核心维度（测什么？）

1.  **真值保真度校验 (Fidelity Validation)**：
    *   **测试对象**：真实拍摄视频（GT）。
    *   **目的**：证明 PDI 在真实物理世界中接近 0。如果真实视频得分很高，说明你的工具本身有问题。
2.  **SOTA 模型横向测评 (SOTA Benchmarking)**：
    *   **测试对象**：Sora、Kling (可灵)、Luma Dream Machine、Runway Gen-3。
    *   **目的**：给出各大模型的 PDI 排名，定义谁才是最强“世界模型”。
3.  **消融实验 (Ablation Study)**：
    *   **目的**：证明为什么需要 $\epsilon_{vp}$（视角耦合）或“旋转自适应修正”。展示如果不加这些项，真实视频（如旋转消防箱）会被误判。
4.  **幻觉灵敏度分析 (Sensitivity Analysis)**：
    *   **目的**：展示 PDI 分数与人类主观评价（MOS）的相关性。

---

### 二、 实验场景设计（具体针对什么场景？）

为了最大化发挥 **SAM2 + Co-Tracker + Mega-SAM** 的合力，建议将实验场景分为以下四类：

#### 1. 经典纵向收敛场景 (The Golden Case)
*   **场景描述**：物体在笔直的参照物（铁轨、公路、长廊）上垂直于画面向远方消失点运动。
*   **对物体的要求**：刚体，轮廓清晰。
*   **实验重点**：审计 $h \cdot Z$ 守恒（尺度）和 $H-VP$ 齐次性（轨迹）。
*   **预期幻觉**：捕捉“越跑越快”或“体积收缩滞后”。

#### 2. 动态背景下的跟随场景 (Tracking Shot)
*   **场景描述**：相机在手持或车载状态下跟随目标移动（由相机位移产生视差）。
*   **对物体的要求**：中等大小，占据画面核心。
*   **实验重点**：利用 Mega-SAM 的位姿还原，审计物体是否在 3D 空间内“打滑”。
*   **预期幻觉**：捕捉“贴图感（Sticker Effect）”——物体像贴在玻璃上，而非踩在地面上。

#### 3. 非刚性生物运动场景 (Biological Motion)
*   **场景描述**：人或动物向远处跑动，伴随剧烈的肢体动作。
*   **对物体的要求**：复杂的非刚性形变。
*   **实验重点**：测试 **$\sigma(R_{integrity})$（结构协同一致性）**。
*   **预期幻觉**：捕捉“体积呼吸感”和肢体在远去过程中的“拉面化”或“溶解”现象。

#### 4. 旋转与复杂姿态场景 (Stress Test)
*   **场景描述**：物体（如转弯的汽车、旋转的方盒）在位移的同时伴随大角度转动。
*   **对物体的要求**：非对称物体。
*   **实验重点**：验证**“旋转自适应修正逻辑”**的有效性。
*   **预期效果**：展示 PDI 如何通过 3D 深度共识排除 2D 投影形变带来的干扰。

---

### 三、 测试物体（Targets）的选择标准

为了保证审计的准确性，物体应满足以下“三性”：

| 要求 | 详细定义 | 推荐物体 | 避免物体 |
| :--- | :--- | :--- | :--- |
| **可分割性** | SAM2 能够给出清晰、闭合的边界。 | 火车、汽车、行人、行李箱 | 烟雾、火焰、透明玻璃杯 |
| **可追踪性** | 表面有纹理，Co-Tracker 不容易跟丢。 | 穿格子衫的人、带涂装的车 | 纯色镜面、极细的线缆 |
| **几何代表性** | 具有明确的高度 $h$ 和质心 $p$。 | 垂直地面的目标 | 趴在地上爬行的生物 |

---

### 四、 实验数据呈现建议（如何展示结果？）

1.  **PDI 指标矩阵表**：
    列出不同模型在“火车”、“行人”、“赛车”等不同场景下的平均 PDI 得分。
2.  **残差演化曲线图**：
    对比真实视频与 AI 视频的 $\epsilon_{scale}$ 曲线。AI 视频通常会有剧烈的波动峰值。
3.  **VP Divergence 可视化图**：
    展示 $VP_{fg}$ 和 $VP_{bg}$ 的偏离。用散点图表示不同模型在“视角耦合”上的偏差分布。
4.  **典型幻觉案例库（The Gallery of Illusions）**：
    截取 PDI 分数极高的帧，配上你的“绿色引导线”物证视频，直观展示 AI 哪里画错了。

### 总结

你的实验部分应该重点突出 **PDI-Eval 作为一个“几何天平”的公正性**。

**一个杀手级的实验逻辑是：**
> “即便在某些低分辨率或有遮挡的场景下，人类肉眼难以断定视频的真伪，但 PDI-Eval 通过审计 $h, x, Z$ 之间的数学比例冲突，能够以 95% 以上的置信度提前预警物理逻辑的崩塌。”

